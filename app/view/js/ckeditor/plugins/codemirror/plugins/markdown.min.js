!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("markdown",function(b,c){function d(a,b,c){return b.f=b.inline=c,c(a,b)}function e(a,b,c){return b.f=b.block=c,c(a,b)}function f(a){return a.linkTitle=!1,a.em=!1,a.strong=!1,a.quote=0,t||a.f!=h||(a.f=l,a.block=g),a.trailingSpace=0,a.trailingSpaceNewLine=!1,a.thisLineHasContent=!1,null}function g(a,b){var f=a.sol(),g=b.list!==!1;b.list!==!1&&b.indentationDiff>=0?(b.indentationDiff<4&&(b.indentation-=b.indentationDiff),b.list=null):b.list!==!1&&b.indentation>0?(b.list=null,b.listDepth=Math.floor(b.indentation/4)):b.list!==!1&&(b.list=!1,b.listDepth=0);var h=null;if(b.indentationDiff>=4)return b.indentation-=4,a.skipToEnd(),"comment";if(a.eatSpace())return null;if(h=a.match(/^#+/))return b.header=h[0].length<=6?h[0].length:6,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,j(b);if(b.prevLineHasContent&&(h=a.match(/^(?:\={1,}|-{1,})$/)))return b.header="="==h[0].charAt(0)?1:2,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,j(b);if(a.eat(">"))return b.indentation++,b.quote=f?1:b.quote+1,c.highlightFormatting&&(b.formatting="quote"),a.eatSpace(),j(b);if("["===a.peek())return d(a,b,p);if(a.match(/^([*\-=_])(?:\s*\1){2,}\s*$/,!0))return"hr";if((!b.prevLineHasContent||g)&&(a.match(/^[*\-+]\s+/,!1)||a.match(/^[0-9]+\.\s+/,!1))){var k=null;return a.match(/^[*\-+]\s+/,!0)?k="ul":(a.match(/^[0-9]+\.\s+/,!0),k="ol"),b.indentation+=4,b.list=!0,b.listDepth++,c.taskLists&&a.match(/^\[(x| )\](?=\s)/,!1)&&(b.taskList=!0),b.f=b.inline,c.highlightFormatting&&(b.formatting=["list","list-"+k]),j(b)}return c.fencedCodeBlocks&&a.match(/^```([\w+#]*)/,!0)?(b.localMode=w(RegExp.$1),b.localMode&&(b.localState=b.localMode.startState()),e(a,b,i),c.highlightFormatting&&(b.formatting="code-block"),b.code=!0,j(b)):d(a,b,b.inline)}function h(a,b){var c=u.token(a,b.htmlState);return(t&&null===b.htmlState.tagStart&&!b.htmlState.context||b.md_inside&&a.current().indexOf(">")>-1)&&(b.f=l,b.block=g,b.htmlState=null),c}function i(a,b){if(a.sol()&&a.match(/^```/,!0)){b.localMode=b.localState=null,b.f=l,b.block=g,c.highlightFormatting&&(b.formatting="code-block"),b.code=!0;var d=j(b);return b.code=!1,d}return b.localMode?b.localMode.token(a,b.localState):(a.skipToEnd(),"comment")}function j(a){var b=[];if(a.formatting){b.push("formatting"),"string"==typeof a.formatting&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)b.push("formatting-"+a.formatting[d]),"header"===a.formatting[d]&&b.push("formatting-"+a.formatting[d]+"-"+a.header),"quote"===a.formatting[d]&&(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push("formatting-"+a.formatting[d]+"-"+a.quote):b.push("error"))}if(a.taskOpen)return b.push("meta"),b.length?b.join(" "):null;if(a.taskClosed)return b.push("property"),b.length?b.join(" "):null;if(a.linkHref)return b.push("string"),b.length?b.join(" "):null;if(a.strong&&b.push("strong"),a.em&&b.push("em"),a.linkText&&b.push("link"),a.code&&b.push("comment"),a.header&&(b.push("header"),b.push("header-"+a.header)),a.quote&&(b.push("quote"),!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push("quote-"+a.quote):b.push("quote-"+c.maxBlockquoteDepth)),a.list!==!1){var e=(a.listDepth-1)%3;e?1===e?b.push("variable-3"):b.push("keyword"):b.push("variable-2")}return a.trailingSpaceNewLine?b.push("trailing-space-new-line"):a.trailingSpace&&b.push("trailing-space-"+(a.trailingSpace%2?"a":"b")),b.length?b.join(" "):null}function k(a,b){if(a.match(/^[^#!\[\]*_\\<>` "'(]+/,!0))return j(b)}function l(b,d){var f=d.text(b,d);if(void 0!==f)return f;if(d.list)return d.list=null,j(d);if(d.taskList){return"x"!==b.match(/^\[(x| )\](?=\s)/,!0)[1]?d.taskOpen=!0:d.taskClosed=!0,c.highlightFormatting&&(d.formatting="task"),d.taskList=!1,j(d)}if(d.taskOpen=!1,d.taskClosed=!1,d.header&&b.match(/^#+$/,!0))return c.highlightFormatting&&(d.formatting="header"),j(d);var g=b.sol(),i=b.next();if(d.escape)return d.escape=!1,j(d);if("\\"===i)return c.highlightFormatting&&(d.formatting="escape"),d.escape=!0,j(d);if(d.linkTitle){d.linkTitle=!1;var k=i;"("===i&&(k=")"),k=(k+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var l="^\\s*(?:[^"+k+"\\\\]+|\\\\\\\\|\\\\.)"+k;if(b.match(new RegExp(l),!0))return"string"}if("`"===i){var o=d.formatting;c.highlightFormatting&&(d.formatting="code");var p=j(d),q=b.pos;b.eatWhile("`");var r=1+b.pos-q;return d.code?r===x?(d.code=!1,p):(d.formatting=o,j(d)):(x=r,d.code=!0,j(d))}if(d.code)return j(d);if("!"===i&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),d.inline=d.f=n,"tag";if("["===i&&b.match(/.*\](\(| ?\[)/,!1))return d.linkText=!0,c.highlightFormatting&&(d.formatting="link"),j(d);if("]"===i&&d.linkText){c.highlightFormatting&&(d.formatting="link");var s=j(d);return d.linkText=!1,d.inline=d.f=n,s}if("<"===i&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=m,c.highlightFormatting&&(d.formatting="link");var s=j(d);return s?s+=" ":s="",s+"link"}if("<"===i&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=m,c.highlightFormatting&&(d.formatting="link");var s=j(d);return s?s+=" ":s="",s+"link"}if("<"===i&&b.match(/^\w/,!1)){if(b.string.indexOf(">")!=-1){var t=b.string.substring(1,b.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(t)&&(d.md_inside=!0)}return b.backUp(1),d.htmlState=a.startState(u),e(b,d,h)}if("<"===i&&b.match(/^\/\w*?>/))return d.md_inside=!1,"tag";var v=!1;if(!c.underscoresBreakWords&&"_"===i&&"_"!==b.peek()&&b.match(/(\w)/,!1)){var w=b.pos-2;if(w>=0){var y=b.string.charAt(w);"_"!==y&&y.match(/(\w)/,!1)&&(v=!0)}}if("*"===i||"_"===i&&!v)if(g&&" "===b.peek());else{if(d.strong===i&&b.eat(i)){c.highlightFormatting&&(d.formatting="strong");var p=j(d);return d.strong=!1,p}if(!d.strong&&b.eat(i))return d.strong=i,c.highlightFormatting&&(d.formatting="strong"),j(d);if(d.em===i){c.highlightFormatting&&(d.formatting="em");var p=j(d);return d.em=!1,p}if(!d.em)return d.em=i,c.highlightFormatting&&(d.formatting="em"),j(d)}else if(" "===i&&(b.eat("*")||b.eat("_"))){if(" "===b.peek())return j(d);b.backUp(1)}return" "===i&&(b.match(/ +$/,!1)?d.trailingSpace++:d.trailingSpace&&(d.trailingSpaceNewLine=!0)),j(d)}function m(a,b){if(">"===a.next()){b.f=b.inline=l,c.highlightFormatting&&(b.formatting="link");var d=j(b);return d?d+=" ":d="",d+"link"}return a.match(/^[^>]+/,!0),"link"}function n(a,b){if(a.eatSpace())return null;var d=a.next();return"("===d||"["===d?(b.f=b.inline=o("("===d?")":"]"),c.highlightFormatting&&(b.formatting="link-string"),b.linkHref=!0,j(b)):"error"}function o(a){return function(b,d){if(b.next()===a){d.f=d.inline=l,c.highlightFormatting&&(d.formatting="link-string");var e=j(d);return d.linkHref=!1,e}return b.match(s(a),!0)&&b.backUp(1),d.linkHref=!0,j(d)}}function p(a,b){return a.match(/^[^\]]*\]:/,!1)?(b.f=q,a.next(),c.highlightFormatting&&(b.formatting="link"),b.linkText=!0,j(b)):d(a,b,l)}function q(a,b){if(a.match(/^\]:/,!0)){b.f=b.inline=r,c.highlightFormatting&&(b.formatting="link");var d=j(b);return b.linkText=!1,d}return a.match(/^[^\]]+/,!0),"link"}function r(a,b){return a.eatSpace()?null:(a.match(/^[^\s]+/,!0),void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),b.f=b.inline=l,"string")}function s(a){return y[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),y[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")),y[a]}var t=a.modes.hasOwnProperty("xml"),u=a.getMode(b,t?{name:"xml",htmlMode:!0}:"text/plain"),v={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},w=function(){var c,d,e={},f={},g=[];for(var h in a.modes)a.modes.propertyIsEnumerable(h)&&g.push(h);for(c=0;c<g.length;c++)e[g[c]]=g[c];var i=[];for(var h in a.mimeModes)a.mimeModes.propertyIsEnumerable(h)&&i.push({mime:h,mode:a.mimeModes[h]});for(c=0;c<i.length;c++)d=i[c].mime,f[d]=i[c].mime;for(var j in v)(v[j]in e||v[j]in f)&&(e[j]=v[j]);return function(c){return e[c]?a.getMode(b,e[c]):null}}();void 0===c.highlightFormatting&&(c.highlightFormatting=!1),void 0===c.maxBlockquoteDepth&&(c.maxBlockquoteDepth=0),void 0===c.underscoresBreakWords&&(c.underscoresBreakWords=!0),void 0===c.fencedCodeBlocks&&(c.fencedCodeBlocks=!1),void 0===c.taskLists&&(c.taskLists=!1);var x=0,y=[],z={startState:function(){return{f:g,prevLineHasContent:!1,thisLineHasContent:!1,block:g,htmlState:null,indentation:0,inline:l,text:k,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&a.copyState(u,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,escape:!1,formatting:!1,linkTitle:b.linkTitle,em:b.em,strong:b.strong,header:b.header,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(a,b){if(b.formatting=!1,a.sol()){var c=a.match(/^\s*$/,!0)||b.header;if(b.header=0,c)return b.prevLineHasContent=!1,f(b);b.prevLineHasContent=b.thisLineHasContent,b.thisLineHasContent=!0,b.escape=!1,b.taskList=!1,b.code=!1,b.trailingSpace=0,b.trailingSpaceNewLine=!1,b.f=b.block;var d=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,e=4*Math.floor((d-b.indentation)/4);e>4&&(e=4);var g=b.indentation+e;if(b.indentationDiff=g-b.indentation,b.indentation=g,d>0)return null}var h=b.f(a,b);return a.start==a.pos?this.token(a,b):h},innerMode:function(a){return a.block==h?{state:a.htmlState,mode:u}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:z}},blankLine:f,getType:j,fold:"markdown"};return z},"xml"),a.defineMIME("text/x-markdown","markdown")});